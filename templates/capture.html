{% extends "base.html" %}

{% block title %}æ‘„åƒå¤´æ‹ç…§ - ç¬¬2è¯¾{% endblock %}

{% block content %}
<h1>ç¬¬2è¯¾ï¼šæ‘„åƒå¤´é¢„è§ˆ + æ‹ç…§</h1>
<p class="subtitle">å­¦ä¹ ç›®æ ‡ï¼šåœ¨é¢„è§ˆçš„åŸºç¡€ä¸Šæ·»åŠ æ‹ç…§åŠŸèƒ½</p>

<div class="info-box">
    <h3>æœ¬è¯¾å†…å®¹</h3>
    <ul>
        <li>åœ¨é¢„è§ˆç”»é¢ä¸Šæ·»åŠ æ‹ç…§æŒ‰é’®</li>
        <li>ä½¿ç”¨Ajaxå‘é€æ‹ç…§è¯·æ±‚</li>
        <li>ä¿å­˜ç…§ç‰‡åˆ°æœåŠ¡å™¨</li>
        <li>æ˜¾ç¤ºæ‹ç…§æˆåŠŸæç¤º</li>
    </ul>
</div>

<div class="camera-container">
    <h2>å®æ—¶é¢„è§ˆ</h2>
    <img src="{{ url_for('video_feed') }}" class="camera-feed" alt="æ‘„åƒå¤´é¢„è§ˆ">
</div>

<div class="controls">
    <button class="btn btn-success" onclick="capturePhoto()">ğŸ“· æ‹ç…§</button>
    <a href="/camera/preview" class="btn">â† ä¸Šä¸€è¯¾</a>
    <a href="/camera/gallery" class="btn">ä¸‹ä¸€è¯¾ï¼šç›¸å†Œ â†’</a>
</div>

<div id="status-message"></div>

{% endblock %}

{% block extra_nav %}
    <a href="/camera/preview">ç¬¬1è¯¾ï¼šé¢„è§ˆ</a>
    <a href="/camera/gallery">ç¬¬3è¯¾ï¼šç›¸å†Œ</a>
{% endblock %}

{% block extra_js %}
<script>
function capturePhoto() {
    const statusDiv = document.getElementById('status-message');
    statusDiv.innerHTML = '<div class="status-message">æ­£åœ¨æ‹ç…§...</div>';

    fetch('/camera/take_photo', {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            statusDiv.innerHTML = `<div class="status-message status-success">âœ“ ${data.message}<br>æ–‡ä»¶: ${data.filename}</div>`;
            setTimeout(() => {
                statusDiv.innerHTML = '';
            }, 3000);
        } else {
            statusDiv.innerHTML = `<div class="status-message status-error">âœ— ${data.message}</div>`;
        }
    })
    .catch(error => {
        statusDiv.innerHTML = '<div class="status-message status-error">âœ— æ‹ç…§å¤±è´¥ï¼Œè¯·é‡è¯•</div>';
        console.error('Error:', error);
    });
}
</script>
{% endblock %}
