{% extends "base.html" %}

{% block title %}å®Œæ•´åŠŸèƒ½ - ç¬¬3è¯¾{% endblock %}

{% block content %}
<h1>ç¬¬3è¯¾ï¼šå®Œæ•´åŠŸèƒ½ï¼ˆé¢„è§ˆ + æ‹ç…§ + ç›¸å†Œï¼‰</h1>
<p class="subtitle">å­¦ä¹ ç›®æ ‡ï¼šæ•´åˆæ‰€æœ‰åŠŸèƒ½ï¼Œå±•ç¤ºå·²æ‹æ‘„çš„ç…§ç‰‡</p>

<div class="info-box">
    <h3>æœ¬è¯¾å†…å®¹</h3>
    <ul>
        <li>å®æ—¶é¢„è§ˆæ‘„åƒå¤´ç”»é¢</li>
        <li>ç‚¹å‡»æŒ‰é’®æ‹ç…§</li>
        <li>æŸ¥çœ‹æ‰€æœ‰å·²æ‹æ‘„çš„ç…§ç‰‡</li>
        <li>ç‚¹å‡»ç…§ç‰‡å¯æŸ¥çœ‹å¤§å›¾</li>
    </ul>
</div>

<div class="camera-container">
    <h2>å®æ—¶é¢„è§ˆ</h2>
    <img src="{{ url_for('video_feed') }}" class="camera-feed" alt="æ‘„åƒå¤´é¢„è§ˆ">
</div>

<div class="controls">
    <button class="btn btn-success" onclick="capturePhoto()">ğŸ“· æ‹ç…§</button>
    <button class="btn" onclick="refreshGallery()">ğŸ”„ åˆ·æ–°ç›¸å†Œ</button>
    <a href="/camera/capture" class="btn">â† ä¸Šä¸€è¯¾</a>
</div>

<div id="status-message"></div>

<div style="margin-top: 30px;">
    <h2>ç…§ç‰‡ç›¸å†Œ (å…± {{ photos|length }} å¼ )</h2>
    {% if photos %}
    <div class="gallery" id="photo-gallery">
        {% for photo in photos %}
        <div>
            <img src="{{ url_for('static', filename='../shots/' + photo) }}"
                 alt="{{ photo }}"
                 onclick="viewPhoto('{{ photo }}')">
            <p style="text-align: center; font-size: 12px; color: #666; margin-top: 5px;">{{ photo }}</p>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p style="text-align: center; color: #666; padding: 20px;">è¿˜æ²¡æœ‰æ‹æ‘„ç…§ç‰‡ï¼Œç‚¹å‡»ä¸Šæ–¹"æ‹ç…§"æŒ‰é’®å¼€å§‹å§ï¼</p>
    {% endif %}
</div>

{% endblock %}

{% block extra_nav %}
    <a href="/camera/preview">ç¬¬1è¯¾ï¼šé¢„è§ˆ</a>
    <a href="/camera/capture">ç¬¬2è¯¾ï¼šæ‹ç…§</a>
{% endblock %}

{% block extra_js %}
<script>
function capturePhoto() {
    const statusDiv = document.getElementById('status-message');
    statusDiv.innerHTML = '<div class="status-message">æ­£åœ¨æ‹ç…§...</div>';

    fetch('/camera/take_photo', {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            statusDiv.innerHTML = `<div class="status-message status-success">âœ“ ${data.message}<br>æ–‡ä»¶: ${data.filename}</div>`;
            // è‡ªåŠ¨åˆ·æ–°ç›¸å†Œ
            setTimeout(() => {
                refreshGallery();
            }, 1000);
        } else {
            statusDiv.innerHTML = `<div class="status-message status-error">âœ— ${data.message}</div>`;
        }
    })
    .catch(error => {
        statusDiv.innerHTML = '<div class="status-message status-error">âœ— æ‹ç…§å¤±è´¥ï¼Œè¯·é‡è¯•</div>';
        console.error('Error:', error);
    });
}

function refreshGallery() {
    location.reload();
}

function viewPhoto(filename) {
    window.open('/shots/' + filename, '_blank');
}
</script>
{% endblock %}
